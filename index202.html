<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ConfiDoc — Functional Prototype (v1)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#FFFFFF; --panel:#FFFFFF; --sidebar:#F7F7F8; --edge:rgba(0,0,0,0.06);
    --text:#111111; --muted:#6B7280; --accent:#111111; --accent-contrast:#FFFFFF;
    --hl-bg:rgba(17,17,17,0.06); --hl-text:#111111; --radius:12px;
  }
  * { box-sizing: border-box; }
  html,body { height:100%; }
  body {
    margin:0; background:var(--bg); color:var(--text);
    font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  }
  .app { display:grid; grid-template-columns:320px 1fr; min-height:100vh; gap:16px; padding:16px; }
  .sidebar, .panel, .card { background:var(--panel); border-radius:var(--radius); box-shadow:0 1px 2px rgba(0,0,0,0.06); }
  .sidebar { padding:16px; display:flex; flex-direction:column; gap:12px; }
  .panel { padding:16px; }
  .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  label { font-size:12px; color:var(--muted); font-weight:600; }
  input[type="text"], select, textarea { width:100%; background:#F5F6F7; border:none; border-radius:10px; padding:10px 12px; font-size:14px; }
  textarea { min-height:120px; resize:vertical; }
  .btn { display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:999px; border:none; background:var(--accent); color:var(--accent-contrast); cursor:pointer; font-weight:600; }
  .btn.secondary { background:transparent; color:#111; border:1px solid rgba(0,0,0,0.10); }
  .btn:disabled { opacity:.5; cursor:not-allowed; }
  .chip { background:#F3F4F6; border:1px solid rgba(0,0,0,0.06); color:#111; border-radius:999px; padding:6px 10px; font-weight:600; font-size:12px; user-select:none; cursor:pointer; }
  .chip.active { background:#111; color:#fff; }
  .list { border:1px dashed rgba(0,0,0,0.1); border-radius:10px; padding:10px; background:#FAFAFB; font-size:13px; color:#374151; }
  .section-title { font-size:13px; font-weight:700; color:#374151; display:flex; align-items:center; gap:8px; cursor:pointer; }
  .chev { width:10px; height:10px; border-right:2px solid #9CA3AF; border-bottom:2px solid #9CA3AF; transform:rotate(-45deg); transition:transform .15s; }
  .collapsed .chev { transform:rotate(135deg); }
  .collapsed + .section-body { display:none; }
  .section-body { margin-top:8px; }
  .toolbar { display:flex; align-items:center; gap:10px; background:#F7F7F8; border-radius:999px; padding:6px; }
  .segment { display:inline-flex; gap:4px; background:#fff; border-radius:999px; padding:4px; }
  .segment button { border:none; background:transparent; padding:6px 10px; border-radius:999px; cursor:pointer; font-weight:600; color:#333; }
  .segment button.active { background:#111; color:#fff; }
  .kpi { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; }
  .kpi .card { padding:12px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .pill { display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; background:#EEF2FF; color:#111; font-weight:600; font-size:12px; }
  .danger { background:#FEF2F2; color:#991B1B; }
  .ok { background:#ECFDF5; color:#065F46; }
  .toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#111; color:#fff; padding:10px 14px; border-radius:10px; opacity:0; transition:opacity .2s, transform .2s; }
  .toast.show { opacity:1; transform:translateX(-50%) translateY(-4px); }
  @media (max-width:1100px) { .app { grid-template-columns:1fr; } }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="toolbar">
      <div class="segment">
        <button id="btnComfort" class="active" type="button">Comfort</button>
        <button id="btnCompact" type="button">Compact</button>
      </div>
      <label style="display:flex; align-items:center; gap:8px; font-weight:600;">
        <input id="darkToggle" type="checkbox" /> Dark
      </label>
    </div>

    <div class="panel">
      <div class="section-title"><span class="chev"></span> Matter details</div>
      <div class="section-body">
        <div class="row">
          <div style="flex:1">
            <label>Client</label>
            <input id="client" type="text" placeholder="Acme Co." />
          </div>
          <div style="flex:1">
            <label>Matter name</label>
            <input id="matter" type="text" placeholder="2025 Master NDA" />
          </div>
        </div>
        <div class="row">
          <div style="flex:1">
            <label>Jurisdiction</label>
            <select id="jurisdiction">
              <option value="">Select…</option>
              <option>Delaware</option>
              <option>California</option>
              <option>New York</option>
              <option>Florida</option>
              <option>Texas</option>
            </select>
          </div>
          <div style="flex:1">
            <label>Document type</label>
            <select id="doctype">
              <option value="">Select…</option>
              <option>NDA</option>
              <option>MSA / Services</option>
              <option>SaaS Agreement</option>
              <option>Sales Agreement</option>
              <option>Lease</option>
              <option>Employment</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="section-title"><span class="chev"></span> Upload documents</div>
      <div class="section-body">
        <input id="fileInput" type="file" multiple accept=".doc,.docx,.pdf,.txt,.rtf,.md" />
        <div id="queue" class="list" style="margin-top:8px;">No files uploaded yet.</div>
        <div class="row" style="margin-top:8px;">
          <button id="btnClearQueue" class="btn secondary" type="button">Clear</button>
          <button id="btnImportSession" class="btn secondary" type="button">Import Session</button>
          <button id="btnExportSession" class="btn" type="button">Export Session</button>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="section-title"><span class="chev"></span> Provision library</div>
      <div class="section-body">
        <div id="chips" class="row">
          <span class="chip" data-provision="Confidentiality">Confidentiality</span>
          <span class="chip" data-provision="Term">Term</span>
          <span class="chip" data-provision="Termination">Termination</span>
          <span class="chip" data-provision="Governing Law">Governing Law</span>
          <span class="chip" data-provision="Indemnification">Indemnification</span>
          <span class="chip" data-provision="Limitation of Liability">Limitation of Liability</span>
          <span class="chip" data-provision="IP Ownership">IP Ownership</span>
          <span class="chip" data-provision="Publicity">Publicity</span>
          <span class="chip" data-provision="Non-Solicit">Non‑Solicit</span>
          <span class="chip" data-provision="Security">Security</span>
        </div>
        <div class="row" style="margin-top:8px;">
          <input id="newProvision" type="text" placeholder="Add custom provision name…" />
          <button id="btnAddProvision" class="btn secondary" type="button">Add</button>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="row">
        <button id="btnAnalyze" class="btn" style="flex:1" type="button">Start analysis</button>
        <button id="btnExtract" class="btn secondary" style="flex:1" type="button">Extract provisions</button>
      </div>
    </div>
  </aside>

  <main class="panel" style="display:flex; flex-direction:column; gap:12px;">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <h2 style="margin:0;">Review workspace</h2>
      <div class="row">
        <span class="pill ok" id="statusReady">Ready</span>
        <span class="pill danger" id="statusIssues" style="display:none;">Issues detected</span>
      </div>
    </div>

    <div class="kpi">
      <div class="card">
        <div style="font-size:12px; color:#6B7280; font-weight:700;">Files</div>
        <div id="kpiFiles" style="font-size:22px; font-weight:800;">0</div>
      </div>
      <div class="card">
        <div style="font-size:12px; color:#6B7280; font-weight:700;">Provisions found</div>
        <div id="kpiProvisions" style="font-size:22px; font-weight:800;">0</div>
      </div>
      <div class="card">
        <div style="font-size:12px; color:#6B7280; font-weight:700;">Open items</div>
        <div id="kpiOpen" style="font-size:22px; font-weight:800;">0</div>
      </div>
      <div class="card">
        <div style="font-size:12px; color:#6B7280; font-weight:700;">Risk</div>
        <div id="kpiRisk" style="font-size:22px; font-weight:800;">Low</div>
      </div>
    </div>

    <div class="panel">
      <div class="row">
        <div style="flex:1;">
          <label>Selected provision</label>
          <select id="provisionSelect"></select>
        </div>
        <div style="flex:1;">
          <label>Decision</label>
          <select id="decision">
            <option value="">Select…</option>
            <option>Accept as‑is</option>
            <option>Modify</option>
            <option>Strike</option>
            <option>Needs review</option>
          </select>
        </div>
        <div style="flex:1;">
          <label>Risk score (0–100)</label>
          <input id="risk" type="range" min="0" max="100" value="20" />
        </div>
      </div>

      <div class="row">
        <div style="flex:1;">
          <label>Extracted text</label>
          <textarea id="extracted" placeholder="Auto‑extracted text for the selected provision appears here…"></textarea>
        </div>
        <div style="flex:1;">
          <label>Proposed redline / notes</label>
          <textarea id="redline" placeholder="Enter redlines, clause swaps, or negotiation notes…"></textarea>
        </div>
      </div>

      <div class="row">
        <button id="btnApplyTemplate" class="btn secondary" type="button">Apply template language</button>
        <button id="btnInsertFallback" class="btn secondary" type="button">Insert fallback</button>
        <button id="btnSaveProvision" class="btn" type="button">Save provision</button>
      </div>
    </div>

    <div class="panel">
      <div class="row">
        <button id="btnExportDocx" class="btn" type="button">Export DOCX (summary)</button>
        <button id="btnExportJson" class="btn secondary" type="button">Export JSON (full)</button>
        <button id="btnClearAll" class="btn secondary" type="button">Clear all</button>
      </div>
      <div class="row" style="font-size:12px; color:#6B7280;">
        <span>Keyboard: <span class="mono">⌘/Ctrl+S</span> save, <span class="mono">⌘/Ctrl+K</span> export JSON, <span class="mono">⌘/Ctrl+J</span> next provision.</span>
      </div>
    </div>

    <div class="panel">
      <div class="section-title"><span class="chev"></span> Activity log</div>
      <div class="section-body">
        <pre id="log" class="list mono" style="white-space:pre-wrap; max-height:220px; overflow:auto;">Session started.</pre>
      </div>
    </div>
  </main>
</div>

<div id="toast" class="toast"></div>

<script>
  // ===== Utilities =====
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));
  const toast = (msg) => { const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1600); };
  const log = (msg) => { const el=$('#log'); const time=new Date().toLocaleTimeString(); el.textContent += "\n[" + time + "] " + msg; el.scrollTop = el.scrollHeight; };

  // Density + dark toggle
  $('#btnComfort').addEventListener('click', () => { document.body.dataset.density='comfortable'; $('#btnComfort').classList.add('active'); $('#btnCompact').classList.remove('active'); });
  $('#btnCompact').addEventListener('click', () => { document.body.dataset.density='compact'; $('#btnCompact').classList.add('active'); $('#btnComfort').classList.remove('active'); });
  $('#darkToggle').addEventListener('change', (e) => { document.body.classList.toggle('dark', e.target.checked); });

  // Sidebar collapsibles
  $$('.section-title').forEach(st => {
    st.addEventListener('click', () => st.classList.toggle('collapsed'));
  });

  // ===== Session state =====
  const state = {
    matter: { client:'', matter:'', jurisdiction:'', doctype:'' },
    files: [], // {name, size}
    provisions: { /* name -> object */ },
    order: [], // provision names
  };

  function saveSession() {
    localStorage.setItem('confidoc_session', JSON.stringify(state));
    toast('Session saved');
  }
  function loadSession() {
    try { const s = JSON.parse(localStorage.getItem('confidoc_session')||'null'); if(!s) return false; Object.assign(state, s); refreshUI(); log('Session loaded from localStorage'); return true; }
    catch(e) { console.error(e); return false; }
  }

  // ===== Matter fields =====
  for (const id of ['client','matter','jurisdiction','doctype']) {
    const el = $('#' + id);
    el.addEventListener('input', () => { state.matter[id] = el.value; saveSession(); });
    el.addEventListener('change', () => { state.matter[id] = el.value; saveSession(); });
  }

  // ===== Upload queue =====
  $('#fileInput').addEventListener('change', (e) => {
    const files = Array.from(e.target.files||[]);
    files.forEach(f => state.files.push({ name:f.name, size:f.size }));
    refreshQueue(); saveSession(); log('Added ' + files.length + ' file(s).');
  });
  function refreshQueue() {
    const q = $('#queue');
    if (state.files.length === 0) q.textContent = 'No files uploaded yet.';
    else q.innerHTML = state.files.map(f => `<div class="row" style="justify-content:space-between"><span>${f.name}</span><span class="mono">${(f.size/1024).toFixed(1)} KB</span></div>`).join('');
    $('#kpiFiles').textContent = state.files.length;
  }
  $('#btnClearQueue').addEventListener('click', () => { state.files = []; refreshQueue(); saveSession(); log('Queue cleared.'); });

  // ===== Provision library =====
  function addProvision(name) {
    if (!name || state.provisions[name]) return;
    state.provisions[name] = { name, extracted:'', redline:'', decision:'', risk:20 };
    state.order.push(name);
    refreshProvisionChips(); refreshProvisionSelect();
  }
  function refreshProvisionChips() {
    // rebuild chip actives
    $$('#chips .chip').forEach(c => c.classList.toggle('active', !!state.provisions[c.dataset.provision]));
  }
  function refreshProvisionSelect() {
    const sel = $('#provisionSelect'); sel.innerHTML = '';
    state.order.forEach(name => { const o=document.createElement('option'); o.value=o.textContent=name; sel.appendChild(o); });
    $('#kpiProvisions').textContent = state.order.length;
  }
  $$('#chips .chip').forEach(chip => chip.addEventListener('click', () => { addProvision(chip.dataset.provision); saveSession(); log('Added provision: ' + chip.dataset.provision); }));
  $('#btnAddProvision').addEventListener('click', () => { const n=$('#newProvision').value.trim(); if(n){ addProvision(n); $('#newProvision').value=''; saveSession(); log('Added custom provision: ' + n); } });

  // ===== Editor panel =====
  function loadProvisionIntoEditor(name) {
    const p = state.provisions[name]; if (!p) return;
    $('#provisionSelect').value = name;
    $('#extracted').value = p.extracted || '';
    $('#redline').value = p.redline || '';
    $('#decision').value = p.decision || '';
    $('#risk').value = p.risk || 20;
  }
  $('#provisionSelect').addEventListener('change', (e) => loadProvisionIntoEditor(e.target.value));
  $('#btnSaveProvision').addEventListener('click', () => {
    const name = $('#provisionSelect').value; if (!name) return toast('Pick a provision first.');
    const p = state.provisions[name];
    p.extracted = $('#extracted').value;
    p.redline   = $('#redline').value;
    p.decision  = $('#decision').value;
    p.risk      = parseInt($('#risk').value||'20',10);
    saveSession(); log('Saved: ' + name);
    $('#kpiOpen').textContent = Object.values(state.provisions).filter(x => (x.decision||'')==='').length;
    const avg = Math.round(Object.values(state.provisions).reduce((a,b)=>a+(b.risk||0),0) / Math.max(1, state.order.length));
    $('#kpiRisk').textContent = (avg<34?'Low':avg<67?'Med':'High');
  });

  $('#btnApplyTemplate').addEventListener('click', () => {
    const name = $('#provisionSelect').value; if (!name) return toast('Pick a provision first.');
    const templates = {
      'Confidentiality': 'Each party shall keep the other\'s Confidential Information secret and use it solely to perform its obligations...',
      'Limitation of Liability': 'Neither party will be liable for indirect, incidental, special, consequential or punitive damages...',
      'Governing Law': 'This Agreement is governed by the laws of the State of Delaware, without regard to conflicts of law principles.'
    };
    $('#redline').value = templates[name] || '<< Insert preferred template language >>';
  });

  $('#btnInsertFallback').addEventListener('click', () => {
    const name = $('#provisionSelect').value; if (!name) return toast('Pick a provision first.');
    $('#redline').value = 'Fallback for ' + name + ': If parties cannot agree, the clause defaults to industry‑standard terms.';
  });

  // ===== Simulated analysis (stub) =====
  $('#btnAnalyze').addEventListener('click', () => {
    toast('Analyzing… (simulated)'); log('Analysis started (stub).');
    // create stubs if empty
    if (state.order.length===0) ['Confidentiality','Term','Termination','Governing Law','Limitation of Liability'].forEach(addProvision);
    state.order.forEach(name => {
      const p = state.provisions[name];
      if (!p.extracted) p.extracted = `[Sample extracted text for ${name}] Lorem ipsum dolor sit amet…`;
    });
    refreshProvisionSelect();
    if (state.order[0]) loadProvisionIntoEditor(state.order[0]);
    saveSession(); log('Analysis completed. Provisions populated.');
  });
  $('#btnExtract').addEventListener('click', () => {
    toast('Extracting provisions… (simulated)'); log('Extraction pass done (stub).');
  });

  // ===== Import/Export =====
  $('#btnExportSession').addEventListener('click', () => {
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'confidoc_session.json'; a.click();
    URL.revokeObjectURL(url); log('Exported session JSON.');
  });
  $('#btnImportSession').addEventListener('click', () => {
    const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
    inp.onchange = (e) => { const f=e.target.files[0]; const r=new FileReader(); r.onload=()=>{ Object.assign(state, JSON.parse(r.result)); refreshUI(); saveSession(); log('Imported session JSON.'); }; r.readAsText(f); };
    inp.click();
  });

  // DOCX summary export (very simple HTML-as-DOCX wrapper)
  function exportDocx() {
    const html = `<!DOCTYPE html><html><head><meta charset='utf-8'></head><body>` +
      `<h1>ConfiDoc Summary</h1>` +
      `<p><b>Client:</b> ${state.matter.client||''} &nbsp; <b>Matter:</b> ${state.matter.matter||''}</p>` +
      `<p><b>Jurisdiction:</b> ${state.matter.jurisdiction||''} &nbsp; <b>Type:</b> ${state.matter.doctype||''}</p>` +
      `<hr/>` +
      state.order.map(n => {
        const p=state.provisions[n];
        return `<h2>${n}</h2>
                <p><b>Decision:</b> ${p.decision||'—'} &nbsp; <b>Risk:</b> ${p.risk||0}</p>
                <h3>Extracted</h3><p>${(p.extracted||'').replace(/&/g,'&amp;').replace(/</g,'&lt;')}</p>
                <h3>Redline / Notes</h3><p>${(p.redline||'').replace(/&/g,'&amp;').replace(/</g,'&lt;')}</p>`;
      }).join('') + `</body></html>`;
    const blob = new Blob([html], {type:'application/vnd.openxmlformats-officedocument.wordprocessingml.document'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='ConfiDoc_Summary.docx'; a.click();
    URL.revokeObjectURL(url);
    log('Exported DOCX (HTML-wrapped).');
  }
  $('#btnExportDocx').addEventListener('click', exportDocx);
  $('#btnExportJson').addEventListener('click', () => { 
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ConfiDoc_Full.json'; a.click(); URL.revokeObjectURL(url);
    log('Exported JSON (full).');
  });

  $('#btnClearAll').addEventListener('click', () => { 
    if(!confirm('Clear all session data?')) return; 
    localStorage.removeItem('confidoc_session'); location.reload();
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if ((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='s') { e.preventDefault(); saveSession(); }
    if ((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='k') { e.preventDefault(); $('#btnExportJson').click(); }
    if ((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='j') { e.preventDefault();
      if (state.order.length===0) return;
      const cur = $('#provisionSelect').value; const i = Math.max(0, state.order.indexOf(cur)); const next = state.order[(i+1)%state.order.length]; loadProvisionIntoEditor(next);
    }
  });

  function refreshUI() {
    // matter
    for (const id of ['client','matter','jurisdiction','doctype']) { const el=$('#'+id); el.value = state.matter[id]||''; }
    // files
    refreshQueue();
    // provisions
    refreshProvisionChips(); refreshProvisionSelect();
    if (state.order[0]) loadProvisionIntoEditor(state.order[0]);
    $('#kpiOpen').textContent = Object.values(state.provisions).filter(x => (x.decision||'')==='').length;
    const avg = Math.round(Object.values(state.provisions).reduce((a,b)=>a+(b.risk||0),0) / Math.max(1, state.order.length));
    $('#kpiRisk').textContent = (avg<34?'Low':avg<67?'Med':'High');
  }

  // Bootstrap
  if (!loadSession()) refreshUI();
</script>
</body>
</html>
